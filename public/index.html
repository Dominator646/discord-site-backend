<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>NeСкам | Вход</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@900&display=swap" rel="stylesheet">
</head>
<body class="bg-[#05050a] text-white flex items-center justify-center h-screen font-['Outfit']">

    <div class="text-center p-10 border border-white/10 rounded-[3rem] bg-white/5 backdrop-blur-xl">
        <h1 class="text-6xl mb-10 font-black italic tracking-tighter">NeСкам</h1>
        <button onclick="startAuth()" class="bg-[#5865F2] px-10 py-5 rounded-2xl font-bold text-xl hover:scale-105 transition-all">
            ВОЙТИ ЧЕРЕЗ DISCORD
        </button>
    </div>

    <script>
        let authWindow;

        function startAuth() {
            const url = "https://discord.com/api/oauth2/authorize?client_id=1431712036626104401&redirect_uri=https://discord-site-backend-production.up.railway.app&response_type=code&scope=identify";
            authWindow = window.open(url, "auth", "width=500,height=750");

            // Ждем сообщения от маленького окна
            window.addEventListener('message', (event) => {
                if (event.data === "auth_success") {
                    window.location.href = "/dashboard.html";
                }
            });

            // Резервный таймер: если окно закрылось, проверяем вход
            const timer = setInterval(() => {
                if (authWindow.closed) {
                    clearInterval(timer);
                    if (localStorage.getItem('logged_user_id')) {
                        window.location.href = "/dashboard.html";
                    }
                }
            }, 1000);
        }
    </script>
</body>
</html>
